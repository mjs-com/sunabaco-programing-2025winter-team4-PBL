# デプロイ手順（Vercel）

## 前提条件
- GitHubアカウントを持っていること
- Vercelアカウント（GitHubアカウントで作成可能）

---

## ステップ1: GitHubにコードをプッシュ

### 1-1. Gitリポジトリを初期化（まだの場合）

```powershell
git init
git add .
git commit -m "Initial commit: クリニック日報アプリ"
```

### 1-2. GitHubでリポジトリを作成

1. https://github.com にアクセス
2. 右上の「+」→「New repository」をクリック
3. リポジトリ名を入力（例: `clinic-diary-app`）
4. 「Public」または「Private」を選択
5. 「Create repository」をクリック

### 1-3. ローカルリポジトリをGitHubにプッシュ

GitHubで表示されるコマンドを実行（例）：

```powershell
git remote add origin https://github.com/あなたのユーザー名/clinic-diary-app.git
git branch -M main
git push -u origin main
```

---

## ステップ2: Vercelアカウントを作成

1. https://vercel.com にアクセス
2. 「Sign Up」をクリック
3. 「Continue with GitHub」を選択してGitHubアカウントでログイン
4. VercelがGitHubリポジトリにアクセスすることを許可

---

## ステップ3: Vercelでプロジェクトをデプロイ

### 3-1. プロジェクトをインポート

1. Vercelのダッシュボードで「Add New...」→「Project」をクリック
2. GitHubリポジトリ一覧から `clinic-diary-app` を選択
3. 「Import」をクリック

### 3-2. プロジェクト設定

- **Framework Preset**: Next.js（自動検出されるはず）
- **Root Directory**: `./`（そのまま）
- **Build Command**: `npm run build`（自動設定）
- **Output Directory**: `.next`（自動設定）

### 3-3. 環境変数を設定 ⚠️ 重要

「Environment Variables」セクションで以下を追加：

| 変数名（Name） | 値（Value） | 説明 |
|--------|-----|------|
| NEXT_PUBLIC_SUPABASE_URL | https://xxxxxxxxxxxxx.supabase.co | SupabaseプロジェクトのURL（クォート不要） |
| NEXT_PUBLIC_SUPABASE_ANON_KEY | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... | SupabaseプロジェクトのAnon Key（クォート不要） |

**注意**: 変数名と値の両方とも、**クォート（''や""）は付けずに**そのまま入力してください。

**環境変数の取得方法**:
1. Supabaseのダッシュボードにアクセス
2. プロジェクトを選択
3. 「Settings」→「API」を開く
4. 「Project URL」と「anon public」キーをコピー

### 3-4. デプロイ実行

1. 「Deploy」ボタンをクリック
2. ビルドが完了するまで待つ（2-3分程度）
3. デプロイが完了すると、URLが表示されます（例: `https://clinic-diary-app.vercel.app`）

---

## ステップ4: デプロイ後の確認

### 4-1. 動作確認

1. 表示されたURLにアクセス
2. ログインページが表示されることを確認
3. ログインしてアプリが正常に動作することを確認

### 4-2. カスタムドメイン（オプション）

必要に応じて、Vercelの「Settings」→「Domains」から独自ドメインを設定できます。

---

## トラブルシューティング

### 開発サーバーが「Starting...」でフリーズする場合

`npm run dev` を実行した際に「Starting...」で止まってしまう場合、以下の手順で対処してください。

#### 対処手順（順番に試してください）

**1. キャッシュをクリアして再起動**

```powershell
# ターミナルで Ctrl+C を押してサーバーを停止
# .next ディレクトリを削除
Remove-Item -Recurse -Force .next

# 再度起動
npm run dev
```

**2. それでも解決しない場合：node_modules も再インストール**

```powershell
# サーバーを停止（Ctrl+C）
# .next と node_modules を削除
Remove-Item -Recurse -Force .next
Remove-Item -Recurse -Force node_modules

# 依存関係を再インストール
npm install

# 再度起動
npm run dev
```

**3. ポート3000が既に使用されている場合**

```powershell
# ポート3000を使用しているプロセスを確認
netstat -ano | findstr :3000

# プロセスID（PID）が表示されたら、そのプロセスを終了
# 例: PID が 12345 の場合
taskkill /PID 12345 /F

# 再度起動
npm run dev
```

**4. それでも解決しない場合：一時ファイルをクリア**

```powershell
# サーバーを停止（Ctrl+C）
# すべてのキャッシュを削除
Remove-Item -Recurse -Force .next
Remove-Item -Recurse -Force node_modules
Remove-Item -Force package-lock.json

# 依存関係を再インストール
npm install

# 再度起動
npm run dev
```

**5. Windows特有の問題：ファイルウォッチャーの制限**

Windowsで大量のファイルを監視する際に制限に達している可能性があります。以下のコマンドで制限を緩和：

```powershell
# PowerShellを管理者として実行してから以下を実行
Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\FileSystem" -Name "LongPathsEnabled" -Value 1
```

その後、PCを再起動してから再度 `npm run dev` を実行してください。

---

### ビルドエラーが発生する場合

1. ローカルでビルドを実行して確認：
   ```powershell
   npm run build
   ```
2. エラーがあれば修正してから再デプロイ

### 環境変数が正しく設定されていない場合

1. Vercelの「Settings」→「Environment Variables」で確認
2. 変数名が正確か確認（`NEXT_PUBLIC_` プレフィックスが必要）
3. 値を再入力して保存

### SupabaseのCORS設定

Supabaseの「Settings」→「API」→「CORS」で、VercelのURLを許可リストに追加：
- `https://あなたのプロジェクト名.vercel.app`

---

## 今後の更新方法

コードを更新したら、GitHubにプッシュするだけで自動的に再デプロイされます：

```powershell
git add .
git commit -m "更新内容の説明"
git push
```

Vercelが自動的に新しいデプロイを開始します。

---

## 参考リンク

- Vercel公式ドキュメント: https://vercel.com/docs
- Next.jsデプロイガイド: https://nextjs.org/docs/deployment
- Supabaseドキュメント: https://supabase.com/docs

